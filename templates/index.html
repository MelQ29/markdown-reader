<!DOCTYPE html>
<html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>MD Reader</title>
        <!-- Highlight.js –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ -->
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/json.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/sql.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/yaml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/markdown.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.2/markdown-it.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/diff_match_patch/20121119/diff_match_patch.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #1a1a1a;
        color: #e0e0e0;
        height: 100vh;
        overflow: hidden;
    }

    .container {
        display: flex;
        height: 100vh;
    }

    /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
    .sidebar {
        width: 300px;
        background-color: #252525;
        border-right: 1px solid #333;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .sidebar-header {
        padding: 20px;
        border-bottom: 1px solid #333;
    }

    .sidebar-header h1 {
        font-size: 24px;
        color: #fff;
        margin-bottom: 15px;
    }

    .upload-section {
        margin-bottom: 15px;
    }

    .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
        width: 100%;
    }

    .file-input-wrapper input[type=file] {
        position: absolute;
        left: -9999px;
    }

    .file-input-label {
        display: block;
        padding: 10px 15px;
        background-color: #ff5555;
        color: white;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: background-color 0.3s;
        font-size: 14px;
    }

    .file-input-label:hover {
        background-color: #ee4444;
    }

    .file-list {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
    }

    .file-item {
        padding: 12px;
        margin-bottom: 8px;
        background-color: #2a2a2a;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.2s;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .file-item:hover {
        background-color: #333;
    }

    .file-item.active {
        background-color: #ff5555;
        color: white;
    }

    .file-name {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        font-size: 14px;
    }

    .file-actions {
        display: flex;
        gap: 5px;
    }

    .rename-btn {
        background-color: #4a90e2;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.2s;
    }

    .rename-btn:hover {
        background-color: #357abd;
    }

    .delete-btn {
        background-color: #ff4444;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.2s;
    }

    .delete-btn:hover {
        background-color: #cc0000;
    }

    .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
        font-size: 14px;
    }

    /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    .content {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .content-header {
        padding: 20px;
        border-bottom: 1px solid #333;
        background-color: #252525;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .content-header h2 {
        font-size: 20px;
        color: #fff;
    }

    .edit-toggle-btn {
        background-color: #4a90e2;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
        display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
    }

    .edit-toggle-btn:hover {
        background-color: #357abd;
    }

    .edit-toggle-btn.editing {
        background-color: #4caf50;
    }

    .edit-toggle-btn.editing:hover {
        background-color: #45a049;
    }

    .content-body {
        flex: 1;
        overflow-y: auto;
        padding: 40px;
        background-color: #1a1a1a;
        position: relative;
    }

    .markdown-editor {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1e1e1e;
        color: #e0e0e0;
        border: none;
        padding: 40px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
        resize: none;
        display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        outline: none;
    }

    .markdown-toolbar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #252525;
        border-top: 1px solid #333;
        padding: 5px 10px;
        display: none; /* –°–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        flex-wrap: wrap;
        gap: 5px;
    }

    .markdown-toolbar.visible {
        display: flex;
    }

    .toolbar-btn {
        background-color: #444;
        color: white;
        border: 1px solid #555;
        padding: 6px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
    }

    .toolbar-btn:hover {
        background-color: #555;
    }

    .toolbar-separator {
        width: 1px;
        background-color: #444;
        margin: 2px 5px;
    }

    .content-body::-webkit-scrollbar {
        width: 10px;
    }

    .content-body::-webkit-scrollbar-track {
        background: #252525;
    }

    .content-body::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 5px;
    }

    .content-body::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    .file-list::-webkit-scrollbar {
        width: 8px;
    }

    .file-list::-webkit-scrollbar-track {
        background: #252525;
    }

    .file-list::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 5px;
    }

    .file-list::-webkit-scrollbar-thumb:hover {
        background: #555;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    .markdown-content {
        max-width: 900px;
        margin: 0 auto;
        line-height: 1.6;
    }

    .markdown-content h1,
    .markdown-content h2,
    .markdown-content h3,
    .markdown-content h4,
    .markdown-content h5,
    .markdown-content h6 {
        color: #fff;
        margin-top: 24px;
        margin-bottom: 16px;
    }

    .markdown-content h1 {
        font-size: 32px;
        border-bottom: 1px solid #333;
        padding-bottom: 10px;
    }

    .markdown-content h2 {
        font-size: 24px;
        border-bottom: 1px solid #333;
        padding-bottom: 8px;
    }

    .markdown-content h3 {
        font-size: 20px;
    }

    .markdown-content p {
        margin-bottom: 16px;
    }

    .markdown-content code {
        background-color: #2a2a2a;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        color: #ff6b6b;
    }

    .markdown-content pre {
        background-color: #2a2a2a;
        padding: 16px;
        border-radius: 5px;
        overflow-x: auto;
        margin-bottom: 16px;
        border: 1px solid #333;
        position: relative;
    }

    .markdown-content pre code {
        background-color: transparent;
        padding: 0;
        color: #e0e0e0;
        display: block;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è highlight.js */
    .markdown-content pre code.hljs {
        padding: 0;
        background: transparent;
    }

    .markdown-content pre.hljs {
        background-color: #2a2a2a;
        padding: 16px;
    }

    .code-block-wrapper {
        position: relative;
        margin-bottom: 16px;
    }

    .copy-button {
        position: absolute;
        top: 8px;
        right: 8px;
        background-color: #ff5555;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        opacity: 0;
        transition: opacity 0.2s, background-color 0.2s;
        z-index: 10;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    .code-block-wrapper:hover .copy-button {
        opacity: 1;
    }

    .copy-button:hover {
        background-color: #ee4444;
    }

    .copy-button:active {
        background-color: #dd3333;
    }

    .copy-button.copied {
        background-color: #4caf50;
    }

    .copy-button.copied::after {
        content: ' ‚úì';
    }

    .markdown-content blockquote {
        border-left: 4px solid #ff5555;
        padding-left: 16px;
        margin: 16px 0;
        color: #aaa;
    }

    .markdown-content ul,
    .markdown-content ol {
        margin-left: 24px;
        margin-bottom: 16px;
    }

    .markdown-content li {
        margin-bottom: 8px;
    }

    .markdown-content table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 16px;
    }

    .markdown-content table th,
    .markdown-content table td {
        border: 1px solid #333;
        padding: 8px 12px;
        text-align: left;
    }

    .markdown-content table th {
        background-color: #2a2a2a;
        font-weight: bold;
    }

    .markdown-content a {
        color: #ff5555;
        text-decoration: none;
    }

    .markdown-content a:hover {
        text-decoration: underline;
    }

    .markdown-content img {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        margin: 16px 0;
    }

    .welcome-message {
        text-align: center;
        color: #666;
        padding: 60px 20px;
    }

    .welcome-message h2 {
        font-size: 28px;
        margin-bottom: 10px;
        color: #888;
    }

    .welcome-message p {
        font-size: 16px;
    }

    .edit-split {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        height: calc(100vh - 160px);
    }

    .edit-split.visible {
        display: grid;
    }

    .edit-pane {
        background-color: #1e1e1e;
        border: 1px solid #333;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    .edit-pane header {
        padding: 10px 14px;
        border-bottom: 1px solid #333;
        background-color: #252525;
        font-weight: 600;
        color: #fff;
    }

    .live-preview {
        flex: 1;
        overflow: auto;
        padding: 16px;
        background-color: #1a1a1a;
    }

    .markdown-editor {
        position: relative;
        flex: 1;
        height: auto;
        display: block;
    }

    .toolbar-container {
        border-top: 1px solid #333;
        background-color: #252525;
    }

    .markdown-toolbar {
        position: relative;
        padding: 8px 10px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        border-top: none;
        bottom: auto;
        left: auto;
    }

    .markdown-toolbar.hidden {
        display: none;
    }

    /* Diff modal after save */
    .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 20px;
    }

    .modal-backdrop.visible {
        display: flex;
    }

    .modal {
        background-color: #1f1f1f;
        border: 1px solid #333;
        border-radius: 10px;
        width: 100%;
        height: 100%;
        max-width: none;
        max-height: none;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }

    .modal-header, .modal-footer {
        padding: 12px 16px;
        border-bottom: 1px solid #333;
        background-color: #252525;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
    }

    .modal-footer {
        border-top: 1px solid #333;
        border-bottom: none;
    }

    .modal-body {
        padding: 12px 16px;
        overflow: auto;
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-height: 0;
        flex: 1;
    }

    .diff-view-toggle {
        display: flex;
        gap: 8px;
    }

    .diff-view-toggle button {
        background-color: #333;
        color: #e0e0e0;
        border: 1px solid #444;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    .diff-view-toggle button.active {
        background-color: #ff5555;
        border-color: #ff5555;
    }

    .diff-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        flex: 1;
        min-height: 50vh;
        align-items: stretch;
    }

    .diff-column {
        background-color: #252525;
        border: 1px solid #333;
        border-radius: 6px;
        padding: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .diff-column h3 {
        margin-bottom: 10px;
        color: #fff;
        font-size: 16px;
    }

    .diff-raw {
        max-height: 240px;
        overflow: auto;
        background-color: #1e1e1e;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 10px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.4;
        margin-bottom: 12px;
        white-space: pre-wrap;
    }

    .diff-rendered {
        flex: 1;
        overflow: auto;
        padding: 10px;
        background-color: #1e1e1e;
        border: 1px solid #333;
        border-radius: 4px;
    }

    .raw-diff-table {
        flex: 1;
        overflow: auto;
        border: 1px solid #333;
        border-radius: 4px;
        min-height: 200px;
    }

    .cancel-edit-btn {
        background-color: #555;
    }

    .cancel-edit-btn:hover {
        background-color: #444;
    }

    .raw-diff-table table.diff {
        width: 100%;
        table-layout: auto;
        border-collapse: collapse;
        font-family: 'Courier New', monospace;
        font-size: 13px;
    }

    .raw-diff-table .diff_header {
        background: #2a2a2a;
        color: #e0e0e0;
    }

    .raw-diff-table .diff_next {
        display: none;
    }

    .raw-diff-table td, .raw-diff-table th {
        border: 1px solid #333;
        padding: 4px 6px;
        color: #e0e0e0;
        white-space: pre;
        word-break: normal;
        vertical-align: top;
    }

    .raw-diff-table .diff_next, .raw-diff-table .diff_header {
        background: #2a2a2a;
    }

    .raw-diff-table .diff_add {
        background: rgba(76, 255, 120, 0.35);
    }

    .raw-diff-table .diff_chg {
        background: rgba(255, 221, 87, 0.35);
    }

    .raw-diff-table .diff_sub {
        background: rgba(255, 110, 110, 0.35);
    }

    .raw-diff-table a {
        color: inherit;
        text-decoration: none;
        pointer-events: none;
    }

    .diff-mark-add {
        background: rgba(76, 255, 120, 0.35) !important;
        color: inherit;
    }

    .diff-mark-sub {
        background: rgba(255, 110, 110, 0.35) !important;
        color: inherit;
    }

    .diff-mark-chg {
        background: rgba(255, 221, 87, 0.35) !important;
        color: inherit;
    }

    /* –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ–Ω —É mark –≤–Ω—É—Ç—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ–Ω–Ω–æ–≥–æ diff */
    .diff-rendered mark {
        background: transparent !important;
        color: inherit;
        padding: 0;
    }

</style>
</head>
<body>
    <div class="container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h1>MD Reader</h1>
                    <div class="upload-section">
                        <div class="file-input-wrapper">
                            <input type="file" id="fileInput" accept=".md" />
                            <label for="fileInput" class="file-input-label">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å .md —Ñ–∞–π–ª</label>
                        </div>
                    </div>
                </div>
                <div class="file-list" id="fileList">
                    <div class="empty-state">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</div>
                </div>
            </div>
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ -->
                <div class="content">
                    <div class="content-header">
                        <h2 id="contentTitle">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</h2>
                        <div style="display: flex; gap: 10px;">
                            <button id="cancelEditBtn" class="edit-toggle-btn cancel-edit-btn" style="display:none;" onclick="cancelEdit()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                            <button id="editToggleBtn" class="edit-toggle-btn" onclick="toggleEditMode()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                        </div>
                    </div>
                    <div class="content-body" id="contentBody">
                        <div class="welcome-message">
                            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                            <p>–ó–∞–≥—Ä—É–∑–∏—Ç–µ .md —Ñ–∞–π–ª, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —á—Ç–µ–Ω–∏–µ</p>
                        </div>
                            <div id="mainMarkdownContent" class="markdown-content"></div>
                        <div id="editSplit" class="edit-split">
                            <div class="edit-pane">
                                <header>Markdown</header>
                                <textarea id="markdownEditor" class="markdown-editor"></textarea>
                                <div class="toolbar-container">
                                    <div id="markdownToolbar" class="markdown-toolbar">
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('**', '**', '–∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç')"><b>B</b></button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('*', '*', '–∫—É—Ä—Å–∏–≤')"><i>I</i></button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('~~', '~~', '–∑–∞—á–µ—Ä–∫–Ω—É—Ç—ã–π')"><s>S</s></button>
                                        <div class="toolbar-separator"></div>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('# ', '', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1', true)">H1</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('## ', '', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2', true)">H2</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('### ', '', '–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3', true)">H3</button>
                                        <div class="toolbar-separator"></div>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('> ', '', '–¶–∏—Ç–∞—Ç–∞', true)">‚Äù</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('`', '`', '–∫–æ–¥')">`</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('```\\n', '\\n```', '–±–ª–æ–∫ –∫–æ–¥–∞')">```</button>
                                        <div class="toolbar-separator"></div>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('* ', '', '–≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞', true)">‚óè</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('1. ', '', '–≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞', true)">1.</button>
                                        <button class="toolbar-btn" onclick="toggleMarkdownFormatting('[', '](https://)', '—Ç–µ–∫—Å—Ç —Å—Å—ã–ª–∫–∏')">üîó</button>
                                    </div>
                                </div>
                            </div>
                            <div class="edit-pane">
                                <header>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</header>
                                <div id="livePreview" class="live-preview markdown-content"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="saveDiffModal" class="modal-backdrop">
                <div class="modal">
                    <div class="modal-header">
                        <div>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–π</div>
                        <div class="diff-view-toggle">
                            <button id="toggleRawDiff" class="active" onclick="setDiffView('raw')">–°—ã—Ä–æ–π diff</button>
                            <button id="toggleRenderedDiff" onclick="setDiffView('rendered')">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
                        </div>
                    </div>
                    <div class="modal-body">
                        <div id="rawDiffBlock">
                            <div class="raw-diff-table" id="saveDiffRawTable"></div>
                        </div>
                        <div id="renderedDiffBlock" style="display:none;">
                            <div class="diff-grid">
                                <div class="diff-column">
                                    <h3>–î–æ</h3>
                                    <div class="diff-rendered markdown-content" id="saveDiffBeforeRendered"></div>
                                </div>
                                <div class="diff-column">
                                    <h3>–ü–æ—Å–ª–µ</h3>
                                    <div class="diff-rendered markdown-content" id="saveDiffAfterRendered"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <div style="display:flex; gap:8px;">
                            <button class="toolbar-btn" onclick="cancelSaveDiff()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                        </div>
                        <button class="toolbar-btn" style="background-color:#4caf50; border-color:#4caf50;" onclick="confirmSaveDiff()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
            </div>
            <script>
                let currentFile = null;
                let rawContent = '';
                let isEditing = false;
                let beforeSaveSnapshot = '';
                let pendingSaveContent = '';
                const md = window.markdownit({
                    html: true,
                    linkify: true,
                    typographer: true,
                    highlight: function (str, lang) {
                        if (lang && hljs.getLanguage(lang)) {
                            try {
                                return hljs.highlight(str, { language: lang }).value;
                            } catch (__) {}
                        }
                        return ''; // use external default escaping
                    }
                });

                let dmp = null;
                try {
                    dmp = new diff_match_patch();
                } catch (e) {
                    console.error('diff_match_patch –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, diff-–ø–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞', e);
                }

                // File upload
                document.getElementById('fileInput').addEventListener('change', async function(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    await uploadWithConflictHandling(file);

                    // Reset input after upload
                    e.target.value = '';
                });

                // Upload with conflict handling
                async function uploadWithConflictHandling(file, newFilename = null) {
                    const formData = new FormData();
                    formData.append('file', file);
                    if (newFilename) {
                        formData.append('newFilename', newFilename);
                    }
                    try {
                        const response = await fetch('/api/upload', {
                            method: 'POST',
                            body: formData
                        });
                        const data = await response.json();
                        if (response.ok) {
                            loadFileList();
                            loadFile(data.filename);
                        } else if (response.status === 409 && data.error === 'file_exists') {
                        const newName = prompt(
                        `–§–∞–π–ª —Å –∏–º–µ–Ω–µ–º "${data.filename}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:`,
                        data.filename.replace('.md', '')
                        );
                        if (newName && newName.trim() !== '') {

                            // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º
                            await uploadWithConflictHandling(file, newName);
                        }
                    } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.error);
                }
            } catch (error) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
        }
    }

    // Load file list
    async function loadFileList() {
        try {
            const response = await fetch('/api/files');
            const files = await response.json();
            const fileList = document.getElementById('fileList');
            if (files.length === 0) {
                fileList.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤</div>';
                return;
            }
            fileList.innerHTML = files.map(file => `
            <div class="file-item ${file.name === currentFile ? 'active' : ''}" data-filename="${file.name}">
            <span class="file-name" onclick="loadFile('${file.name}')">${file.name}</span>
            <div class="file-actions">
            <button class="rename-btn" onclick="renameFile('${file.name}', event)">‚úèÔ∏è</button>
            <button class="delete-btn" onclick="deleteFile('${file.name}', event)">‚úï</button>
            </div>
            </div>
            `).join('');
        } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤:', error);
    }
}

// Rename file
async function renameFile(filename, event) {
    event.stopPropagation();
    const newName = prompt(`–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª "${filename}":`, filename.replace('.md', ''));
    if (!newName || newName.trim() === '' || newName === filename.replace('.md', '')) {
        return;
    }
    try {
        const response = await fetch(`/api/rename/${filename}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ newName: newName })
        });
        const data = await response.json();
        if (response.ok) {
            if (currentFile === filename) {

                // –ï—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª–∏ —Ç–µ–∫—É—â–∏–π –æ—Ç–∫—Ä—ã—Ç—ã–π —Ñ–∞–π–ª, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ —Å –Ω–æ–≤—ã–º –∏–º–µ–Ω–µ–º
                loadFile(data.newName);
            } else {

            // –ò–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            loadFileList();
        }
    } else {
    alert('–û—à–∏–±–∫–∞: ' + data.error);
}
} catch (error) {
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
}
}

// Load file content
async function loadFile(filename) {

    // Exit edit mode if a new file is being opened
    if (isEditing) {
        toggleEditMode(true); // Exit edit mode without saving
    }
    try {
        const response = await fetch(`/api/file/${filename}`);
        const data = await response.json();
        if (response.ok) {
            currentFile = filename;
            rawContent = data.raw_content; // Preserve original content
            document.getElementById('contentTitle').textContent = data.filename;
            const contentBody = document.getElementById('contentBody');

            let viewer = contentBody.querySelector('#mainMarkdownContent');
            if (!viewer) {
                viewer = document.createElement('div');
                viewer.id = 'mainMarkdownContent';
                viewer.className = 'markdown-content';
                contentBody.prepend(viewer);
            }
            viewer.innerHTML = data.html_content;
            let editor = contentBody.querySelector('#markdownEditor');
            editor.value = rawContent;

            document.getElementById('editToggleBtn').style.display = 'block';
            showWelcome(false);
            highlightCode();
            addCopyButtons();
            loadFileList();
        } else {
        alert('–û—à–∏–±–∫–∞: ' + data.error);
    }
} catch (error) {
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ' + error.message);
}
}

// Toggle edit mode
function toggleEditMode(forceExit = false) {
    const editor = document.getElementById('markdownEditor');
    const viewer = getMainViewer();
    const toggleBtn = document.getElementById('editToggleBtn');
    const toolbar = document.getElementById('markdownToolbar');
    const split = document.getElementById('editSplit');
    const livePreview = document.getElementById('livePreview');
    const cancelBtn = document.getElementById('cancelEditBtn');
    if (!currentFile) return;

    if (forceExit) {
        isEditing = false;
        split.classList.remove('visible');
        viewer.style.display = 'block';
        toolbar.classList.add('hidden');
        toggleBtn.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
        toggleBtn.classList.remove('editing');
        cancelBtn.style.display = 'none';
        pendingSaveContent = '';
        return;
    }

    // Enter edit mode
    if (!isEditing) {
        isEditing = true;
        beforeSaveSnapshot = rawContent;
        split.classList.add('visible');
        viewer.style.display = 'none';
        editor.value = rawContent;
        renderLivePreview(editor.value, livePreview);
        toolbar.classList.remove('hidden');
        editor.focus();
        toggleBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
        toggleBtn.classList.add('editing');
        cancelBtn.style.display = 'block';
        return;
    }

    // Already editing: show diff before saving
    openSaveDiffPreview();
}

// Apply or remove markdown formatting
function toggleMarkdownFormatting(prefix, suffix, placeholder, isBlock = false) {
    const editor = document.getElementById('markdownEditor');
    const start = editor.selectionStart;
    const end = editor.selectionEnd;
    let originalSelection = editor.value.substring(start, end);

    // Block-level formatting (headings, quotes, lists)
    if (isBlock) {
        const lineStart = editor.value.lastIndexOf('\n', start - 1) + 1;
        let lineEnd = editor.value.indexOf('\n', start);
        if (lineEnd === -1) {
            lineEnd = editor.value.length;
        }
        const originalLine = editor.value.substring(lineStart, lineEnd);

        if (originalLine.trim().startsWith(prefix)) {

            // Remove block formatting
            const firstCharIndex = originalLine.search(/\S/);
            const newLine = originalLine.substring(0, firstCharIndex) + originalLine.substring(firstCharIndex + prefix.length);
            editor.setRangeText(newLine, lineStart, lineEnd);
            editor.setSelectionRange(lineStart, lineStart + newLine.length);
        } else {

        // Apply block formatting
        editor.setRangeText(prefix, lineStart, lineStart);
        editor.setSelectionRange(lineStart + prefix.length, lineStart + prefix.length + originalLine.length);
    }
    editor.focus();
    return;
}

// Inline wrappers (bold, italic, etc.)
const beforeSelection = editor.value.substring(start - prefix.length, start);
const afterSelection = editor.value.substring(end, end + suffix.length);
if (beforeSelection === prefix && afterSelection === suffix) {

    // Remove formatting even if selection is empty
    const unwrappedText = editor.value.substring(start, end);
    editor.setRangeText(unwrappedText, start - prefix.length, end + suffix.length);
    const newCursorPos = start - prefix.length;
    editor.setSelectionRange(newCursorPos, newCursorPos + unwrappedText.length);
} else {

// Apply formatting
const textToWrap = originalSelection.length > 0 ? originalSelection : placeholder;
const newText = prefix + textToWrap + suffix;
editor.setRangeText(newText, start, end);

// Select inner text for easy toggle/edit
const newStart = start + prefix.length;
const newEnd = newStart + textToWrap.length;
editor.setSelectionRange(newStart, newEnd);
}
editor.focus();
}

// Syntax highlighting
function highlightCode() {
    const codeBlocks = document.querySelectorAll('.markdown-content pre code');
    codeBlocks.forEach((block) => {
        hljs.highlightElement(block);
    });
}

function highlightCodeIn(container) {
    const codeBlocks = container.querySelectorAll('pre code');
    codeBlocks.forEach((block) => {
        hljs.highlightElement(block);
    });
}

function getMainViewer() {
    return document.getElementById('mainMarkdownContent');
}

function showWelcome(visible) {
    const welcome = document.querySelector('.welcome-message');
    if (!welcome) return;
    welcome.style.display = visible ? 'block' : 'none';
}

function renderLivePreview(text = '', target = null) {
    const preview = target || document.getElementById('livePreview');
    if (!preview) return;
    preview.innerHTML = md.render(text);
    highlightCodeIn(preview);
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∫ –±–ª–æ–∫–∞–º –∫–æ–¥–∞
function addCopyButtons() {
    const codeBlocks = document.querySelectorAll('.markdown-content pre code');
    codeBlocks.forEach((codeBlock) => {
        if (codeBlock.parentElement.querySelector('.copy-button')) {
            return;
        }
        const pre = codeBlock.parentElement;
        const wrapper = document.createElement('div');
        wrapper.className = 'code-block-wrapper';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
        copyButton.setAttribute('aria-label', '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥');
        pre.parentNode.insertBefore(wrapper, pre);
        wrapper.appendChild(pre);
        wrapper.appendChild(copyButton);
        copyButton.addEventListener('click', async () => {
            const codeText = codeBlock.textContent || codeBlock.innerText;
            try {
                await navigator.clipboard.writeText(codeText);
                copyButton.classList.add('copied');
                copyButton.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
                setTimeout(() => {
                    copyButton.classList.remove('copied');
                    copyButton.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
                }, 2000);
            } catch (err) {
            const textArea = document.createElement('textarea');
            textArea.value = codeText;
            textArea.style.position = 'fixed';
            textArea.style.opacity = '0';
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                copyButton.classList.add('copied');
                copyButton.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
                setTimeout(() => {
                    copyButton.classList.remove('copied');
                    copyButton.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
                }, 2000);
            } catch (err) {
            alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥');
        }
        document.body.removeChild(textArea);
    }
});
});
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
async function deleteFile(filename, event) {
    event.stopPropagation();
    if (!confirm(`–£–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª "${filename}"?`)) {
        return;
    }
    try {
        const response = await fetch(`/api/delete/${filename}`, {
            method: 'DELETE'
        });
        const data = await response.json();
        if (response.ok) {
            if (currentFile === filename) {
                currentFile = null;
                document.getElementById('contentTitle').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
                const viewer = getMainViewer();
                if (viewer) viewer.innerHTML = '';
                showWelcome(true);
                document.getElementById('editToggleBtn').style.display = 'none';
                const split = document.getElementById('editSplit');
                const toolbar = document.getElementById('markdownToolbar');
                split.classList.remove('visible');
                toolbar.classList.add('hidden');
                isEditing = false;
            }
            loadFileList();
        } else {
        alert('–û—à–∏–±–∫–∞: ' + data.error);
    }
} catch (error) {
alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
}
}

async function showSaveDiff(beforeRaw, afterRaw) {
    try {
        const response = await fetch('/api/diff/preview', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                before_content: beforeRaw,
                after_content: afterRaw,
                before_name: `${currentFile} (–¥–æ)`,
                after_name: `${currentFile} (–ø–æ—Å–ª–µ)`
            })
        });
        const data = await response.json();
        if (!response.ok) {
            console.error('–û—à–∏–±–∫–∞ diff:', data.error);
            return;
        }

        document.getElementById('saveDiffRawTable').innerHTML = data.raw_diff_html;
        const beforeRendered = document.getElementById('saveDiffBeforeRendered');
        const afterRendered = document.getElementById('saveDiffAfterRendered');
        beforeRendered.innerHTML = renderDiffSide(data.before.raw_content, data.after.raw_content, 'before');
        afterRendered.innerHTML = renderDiffSide(data.before.raw_content, data.after.raw_content, 'after');
        highlightCodeIn(beforeRendered);
        highlightCodeIn(afterRendered);
        cleanDiffTable(document.getElementById('saveDiffRawTable'));

        setDiffView('raw');
        document.getElementById('saveDiffModal').classList.add('visible');
        setupRenderedDiffScrollSync();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ diff:', error);
    }
}

function setDiffView(view) {
    const rawBlock = document.getElementById('rawDiffBlock');
    const renderedBlock = document.getElementById('renderedDiffBlock');
    const rawBtn = document.getElementById('toggleRawDiff');
    const rendBtn = document.getElementById('toggleRenderedDiff');
    if (view === 'raw') {
        rawBlock.style.display = 'block';
        renderedBlock.style.display = 'none';
        rawBtn.classList.add('active');
        rendBtn.classList.remove('active');
    } else {
        rawBlock.style.display = 'none';
        renderedBlock.style.display = 'block';
        rawBtn.classList.remove('active');
        rendBtn.classList.add('active');
    }
}

function closeSaveDiffModal() {
    document.getElementById('saveDiffModal').classList.remove('visible');
}

async function openSaveDiffPreview() {
    const editor = document.getElementById('markdownEditor');
    const newContent = editor.value;
    pendingSaveContent = newContent;
    await showSaveDiff(beforeSaveSnapshot, newContent);
}

async function confirmSaveDiff() {
    await persistSave(pendingSaveContent);
    closeSaveDiffModal();
}

function cancelSaveDiff() {
    closeSaveDiffModal();
    pendingSaveContent = '';
    // stay in edit mode so user can continue typing
}

function cancelEdit() {
    if (!isEditing) return;
    const viewer = getMainViewer();
    const split = document.getElementById('editSplit');
    const toolbar = document.getElementById('markdownToolbar');
    const toggleBtn = document.getElementById('editToggleBtn');
    const editor = document.getElementById('markdownEditor');
    const cancelBtn = document.getElementById('cancelEditBtn');
    // revert to content from edit start
    editor.value = beforeSaveSnapshot;
    renderLivePreview(editor.value);
    isEditing = false;
    split.classList.remove('visible');
    viewer.style.display = 'block';
    toolbar.classList.add('hidden');
    toggleBtn.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
    toggleBtn.classList.remove('editing');
    cancelBtn.style.display = 'none';
    pendingSaveContent = '';
}

async function persistSave(newContent) {
    if (!currentFile) return;
    try {
        const response = await fetch(`/api/file/${currentFile}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ content: newContent })
        });
        const data = await response.json();
        if (response.ok) {
            rawContent = newContent;
            isEditing = false;
            const viewer = getMainViewer();
            const split = document.getElementById('editSplit');
            const toolbar = document.getElementById('markdownToolbar');
            const toggleBtn = document.getElementById('editToggleBtn');
            const cancelBtn = document.getElementById('cancelEditBtn');
            split.classList.remove('visible');
            viewer.style.display = 'block';
            toolbar.classList.add('hidden');
            toggleBtn.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            toggleBtn.classList.remove('editing');
            cancelBtn.style.display = 'none';
            pendingSaveContent = '';
            await loadFile(currentFile);
        } else {
            alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + data.error);
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
    }
}

function cleanDiffTable(container) {
    if (!container) return;
    const anchors = container.querySelectorAll('a');
    anchors.forEach(a => {
        const span = document.createElement('span');
        span.textContent = a.textContent;
        a.replaceWith(span);
    });
}

function renderDiffSide(rawA, rawB, mode) {
    // mode: 'before' or 'after'
    if (!dmp) {
        // fallback: –ø—Ä–æ—Å—Ç–æ —Ä–µ–Ω–¥–µ—Ä –±–µ–∑ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        return md.render(mode === 'before' ? rawA : rawB);
    }
    const diffs = dmp.diff_main(rawA, rawB);
    dmp.diff_cleanupSemantic(diffs);

    const normalized = [];
    for (let i = 0; i < diffs.length; i++) {
        const [op, text] = diffs[i];
        const next = diffs[i + 1];
        if (op === -1 && next && next[0] === 1) {
            normalized.push(['chgBefore', text]);
            normalized.push(['chgAfter', next[1]]);
            i++;
            continue;
        }
        if (op === 1 && next && next[0] === -1) {
            normalized.push(['chgBefore', next[1]]);
            normalized.push(['chgAfter', text]);
            i++;
            continue;
        }
        if (op === 0) normalized.push(['eq', text]);
        else if (op === -1) normalized.push(['del', text]);
        else if (op === 1) normalized.push(['add', text]);
    }

    function wrapTokens(text, cls) {
        if (!cls) return md.utils.escapeHtml(text);
        const trimmed = text.trimStart();
        // –ù–µ –≤–º–µ—à–∏–≤–∞–µ–º—Å—è –≤ –∫–æ–¥–æ–≤—ã–µ –±–ª–æ–∫–∏/–∏–Ω–ª–∞–π–Ω-–∫–æ–¥, —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –ø–æ–¥—Å–≤–µ—Ç–∫—É
        if (trimmed.startsWith('```') || trimmed.startsWith('`')) {
            return md.utils.escapeHtml(text);
        }
        return `<mark class="${cls}">${md.utils.escapeHtml(text)}</mark>`;
    }

    const parts = normalized.map(([op, text]) => {
        let cls = '';
        if (mode === 'before') {
            if (op === 'del') cls = 'diff-mark-sub';
            else if (op === 'chgBefore') cls = 'diff-mark-chg';
        } else {
            if (op === 'add') cls = 'diff-mark-add';
            else if (op === 'chgAfter') cls = 'diff-mark-chg';
        }
        if (cls === '' && (op === 'add' || op === 'del' || op === 'chgBefore' || op === 'chgAfter')) {
            // —Å–∫—Ä—ã–≤–∞–µ–º –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–µ –¥–ª—è –¥–∞–Ω–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
            return '';
        }
        return wrapTokens(text, cls);
    }).join('');

    return md.render(parts);
}

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∂–∏–≤–æ–π –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
document.getElementById('markdownEditor').addEventListener('input', (e) => {
    renderLivePreview(e.target.value);
});

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
let editSyncLock = false;
function syncEditScroll(source, target) {
    if (editSyncLock) return;
    editSyncLock = true;
    const ratio = source.scrollTop / Math.max(1, source.scrollHeight - source.clientHeight);
    target.scrollTop = ratio * Math.max(1, target.scrollHeight - target.clientHeight);
    editSyncLock = false;
}
const editorEl = document.getElementById('markdownEditor');
const livePreviewEl = document.getElementById('livePreview');
editorEl.addEventListener('scroll', () => syncEditScroll(editorEl, livePreviewEl));
livePreviewEl.addEventListener('scroll', () => syncEditScroll(livePreviewEl, editorEl));

// –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–∫—Ä–æ–ª–ª–∞ –≤ rendered diff
let renderedDiffSyncLock = false;
function setupRenderedDiffScrollSync() {
    const before = document.getElementById('saveDiffBeforeRendered');
    const after = document.getElementById('saveDiffAfterRendered');
    if (!before || !after) return;
    before.addEventListener('scroll', () => syncRenderedDiff(before, after));
    after.addEventListener('scroll', () => syncRenderedDiff(after, before));
}
function syncRenderedDiff(source, target) {
    if (renderedDiffSyncLock) return;
    renderedDiffSyncLock = true;
    const ratio = source.scrollTop / Math.max(1, source.scrollHeight - source.clientHeight);
    target.scrollTop = ratio * Math.max(1, target.scrollHeight - target.clientHeight);
    renderedDiffSyncLock = false;
}

// –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã–≤–∞–µ–º —Ç—É–ª–±–∞—Ä
document.getElementById('markdownToolbar').classList.add('hidden');
document.getElementById('cancelEditBtn').style.display = 'none';

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
loadFileList();
</script>
</body>
</html>